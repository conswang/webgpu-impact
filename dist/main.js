(()=>{"use strict";var t={d:(e,i)=>{for(var r in i)t.o(i,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{R1:()=>B,J_:()=>S,QR:()=>U,an:()=>C,qf:()=>E});var e=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array;function r(){var t=new i(3);return i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function n(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function h(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function a(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function u(t,e){var i=e[0],r=e[1],s=e[2],o=i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function l(t,e,i){var r=e[0],s=e[1],o=e[2],n=i[0],h=i[1],a=i[2];return t[0]=s*a-o*h,t[1]=o*n-r*a,t[2]=r*h-s*n,t}function c(){var t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function f(t,i,r,s){var o,n,h,a,u,l,c,f,p,d,v,m,g,y,w,x,b,A,T,k,P,B,U,S,E=s[0],C=s[1],F=s[2],M=Math.hypot(E,C,F);return M<e?null:(E*=M=1/M,C*=M,F*=M,o=Math.sin(r),h=1-(n=Math.cos(r)),a=i[0],u=i[1],l=i[2],c=i[3],f=i[4],p=i[5],d=i[6],v=i[7],m=i[8],g=i[9],y=i[10],w=i[11],x=E*E*h+n,b=C*E*h+F*o,A=F*E*h-C*o,T=E*C*h-F*o,k=C*C*h+n,P=F*C*h+E*o,B=E*F*h+C*o,U=C*F*h-E*o,S=F*F*h+n,t[0]=a*x+f*b+m*A,t[1]=u*x+p*b+g*A,t[2]=l*x+d*b+y*A,t[3]=c*x+v*b+w*A,t[4]=a*T+f*k+m*P,t[5]=u*T+p*k+g*P,t[6]=l*T+d*k+y*P,t[7]=c*T+v*k+w*P,t[8]=a*B+f*U+m*S,t[9]=u*B+p*U+g*S,t[10]=l*B+d*U+y*S,t[11]=c*B+v*U+w*S,i!==t&&(t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t)}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),r();class p{constructor(t){this.texture=void 0,this.sampler=void 0,this.bitmap=void 0,this.filepath=void 0,this.filepath=t}setFilepath(t){this.filepath=t}create(t){return e=this,i=void 0,s=function*(){const e=document.createElement("img");e.src=new URL(this.filepath,"file:///C:/Users/eyada/Desktop/webgpu-impact/src/types/texture.ts").toString(),yield e.decode();const i=yield fetch(this.filepath);if(!i.ok)return console.error("Network error",i.status);const r=yield i.blob();this.bitmap=yield createImageBitmap(r),console.log(this.bitmap),this.texture=t.createTexture({size:[this.bitmap.width,this.bitmap.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),t.queue.copyExternalImageToTexture({source:this.bitmap},{texture:this.texture},[this.bitmap.width,this.bitmap.height])},new((r=void 0)||(r=Promise))((function(t,o){function n(t){try{a(s.next(t))}catch(t){o(t)}}function h(t){try{a(s.throw(t))}catch(t){o(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,h)}a((s=s.apply(e,i||[])).next())}));var e,i,r,s}}var d;class v{constructor(t){this.vertCount=0,this.idxCount=0,this.positions=new Array,this.normals=new Array,this.uvs=new Array,this.faces=new Array,this.texture=void 0,this.translate=r(),this.rotate=r(),this.createCube(),this.populateVBO();const e=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,i={size:this.vertDataVBO.byteLength,usage:e,mappedAtCreation:!0};this.buffer=t.createBuffer(i),new Float32Array(this.buffer.getMappedRange()).set(this.vertDataVBO),this.buffer.unmap(),this.bufferLayout={arrayStride:32,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12},{shaderLocation:2,format:"float32x2",offset:24}]}}createTexture(t,e){return i=this,r=void 0,o=function*(){this.texture=new p(e),yield this.texture.create(t)},new((s=void 0)||(s=Promise))((function(t,e){function n(t){try{a(o.next(t))}catch(t){e(t)}}function h(t){try{a(o.throw(t))}catch(t){e(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(n,h)}a((o=o.apply(i,r||[])).next())}));var i,r,s,o}addVertex(t){console.log("adding vertex"),console.log(t.pos),console.log(t.nor),console.log(t.uv),this.positions.push(t.pos),this.normals.push(t.nor),this.uvs.push(t.uv),this.vertCount++}addFace(t){let e=new Array;for(let i=0;i<t.length;i++)e.push(this.vertCount),this.addVertex(t[i]);this.faces.push(new m(e))}addFaceIndices(t){this.faces.push(new m(t))}rotateMesh(){this.rotate[1]+=.01}populateVBO(){var t=new Array;for(let e=0;e<this.faces.length;e++){const i=this.faces[e];for(let e=0;e<i.vertCount-2;e++){const r=this.positions[i.verts[0]],s=this.positions[i.verts[e+1]],o=this.positions[i.verts[e+2]],n=this.normals[i.verts[0]],h=this.normals[i.verts[e+1]],a=this.normals[i.verts[e+2]],u=this.uvs[i.verts[0]],l=this.uvs[i.verts[e+1]],c=this.uvs[i.verts[e+2]];t.push(r[0]),t.push(r[1]),t.push(r[2]),t.push(n[0]),t.push(n[1]),t.push(n[2]),t.push(u[0]),t.push(u[1]),t.push(s[0]),t.push(s[1]),t.push(s[2]),t.push(h[0]),t.push(h[1]),t.push(h[2]),t.push(l[0]),t.push(l[1]),t.push(o[0]),t.push(o[1]),t.push(o[2]),t.push(a[0]),t.push(a[1]),t.push(a[2]),t.push(c[0]),t.push(c[1]),this.idxCount+=3,console.log("Adding Triangle"),console.log([0,e+1,e+2]),console.log([i.verts[0],i.verts[e+1],i.verts[e+2]])}}this.vertDataVBO=new Float32Array(t),console.log(this.vertCount),console.log(this.idxCount)}getModelMatrix(){let t=c();var e,i,r,s,o,n,h,a,u,l,p,d,v,m,g,y,w,x;return f(t,t,this.rotate[0],[1,0,0]),f(t,t,this.rotate[1],[0,1,0]),f(t,t,this.rotate[2],[0,0,1]),e=t,i=t,y=(r=this.translate)[0],w=r[1],x=r[2],i===e?(e[12]=i[0]*y+i[4]*w+i[8]*x+i[12],e[13]=i[1]*y+i[5]*w+i[9]*x+i[13],e[14]=i[2]*y+i[6]*w+i[10]*x+i[14],e[15]=i[3]*y+i[7]*w+i[11]*x+i[15]):(s=i[0],o=i[1],n=i[2],h=i[3],a=i[4],u=i[5],l=i[6],p=i[7],d=i[8],v=i[9],m=i[10],g=i[11],e[0]=s,e[1]=o,e[2]=n,e[3]=h,e[4]=a,e[5]=u,e[6]=l,e[7]=p,e[8]=d,e[9]=v,e[10]=m,e[11]=g,e[12]=s*y+a*w+d*x+i[12],e[13]=o*y+u*w+v*x+i[13],e[14]=n*y+l*w+m*x+i[14],e[15]=h*y+p*w+g*x+i[15]),t}createCube(){let t=new Array;t.push({pos:[-1,-1,-1],nor:[0,0,-1],uv:[0,0]}),t.push({pos:[1,-1,-1],nor:[0,0,-1],uv:[0,1]}),t.push({pos:[1,1,-1],nor:[0,0,-1],uv:[1,1]}),t.push({pos:[-1,1,-1],nor:[0,0,-1],uv:[1,0]});let e=new Array;e.push({pos:[-1,-1,1],nor:[0,0,1],uv:[0,0]}),e.push({pos:[1,-1,1],nor:[0,0,1],uv:[0,1]}),e.push({pos:[1,1,1],nor:[0,0,1],uv:[1,1]}),e.push({pos:[-1,1,1],nor:[0,0,1],uv:[1,0]});let i=new Array;i.push({pos:[-1,-1,-1],nor:[0,-1,0],uv:[0,0]}),i.push({pos:[1,-1,-1],nor:[0,-1,0],uv:[0,1]}),i.push({pos:[1,-1,1],nor:[0,-1,0],uv:[1,1]}),i.push({pos:[-1,-1,1],nor:[0,-1,0],uv:[1,0]});let r=new Array;r.push({pos:[-1,1,-1],nor:[0,1,0],uv:[0,0]}),r.push({pos:[1,1,-1],nor:[0,1,0],uv:[0,1]}),r.push({pos:[1,1,1],nor:[0,1,0],uv:[1,1]}),r.push({pos:[-1,1,1],nor:[0,1,0],uv:[1,0]});let s=new Array;s.push({pos:[-1,-1,-1],nor:[-1,0,0],uv:[0,0]}),s.push({pos:[-1,1,-1],nor:[-1,0,0],uv:[0,1]}),s.push({pos:[-1,1,1],nor:[-1,0,0],uv:[1,1]}),s.push({pos:[-1,-1,1],nor:[-1,0,0],uv:[1,0]});let o=new Array;o.push({pos:[1,-1,-1],nor:[1,0,0],uv:[0,0]}),o.push({pos:[1,1,-1],nor:[1,0,0],uv:[0,1]}),o.push({pos:[1,1,1],nor:[1,0,0],uv:[1,1]}),o.push({pos:[1,-1,1],nor:[1,0,0],uv:[1,0]}),this.addFace(t),this.addFace(e),this.addFace(i),this.addFace(r),this.addFace(s),this.addFace(o)}}class m{constructor(t){this.vertCount=0,this.verts=new Array;for(let e=0;e<t.length;e++)this.verts.push(t[e]);this.vertCount=t.length}addVertex(t){this.verts.push(t),this.vertCount++}}function g(){var t=new i(4);return i!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function y(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function w(t,e,i){var r=e[0],s=e[1],o=e[2],n=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*o+i[12]*n,t[1]=i[1]*r+i[5]*s+i[9]*o+i[13]*n,t[2]=i[2]*r+i[6]*s+i[10]*o+i[14]*n,t[3]=i[3]*r+i[7]*s+i[11]*o+i[15]*n,t}d=new i(2),i!=Float32Array&&(d[0]=0,d[1]=0),g();class x{constructor(t,e,o,n,a,c,f,p){var d,v,m;this.eye=r(),this.ref=r(),this.up=r(),this.right=r(),this.look=r(),this.theta=0,this.phi=0,this.fovy=t,this.aspect=(d=e,v=o,(m=new i(2))[0]=d,m[1]=v,m),this.nearClip=n,this.farClip=a,s(this.eye,c),s(this.ref,f),s(this.up,p),u(this.up,this.up),h(this.look,f,c),u(this.look,this.look),l(this.right,p,this.look),u(this.right,this.right)}calculateRotation(){let t=r();o(t,1,0,0);let e=r();o(e,0,1,0);let i=c();f(i,i,this.phi,t);let s=c();f(s,s,this.theta,e);let h=g();y(h,0,0,1,0),w(h,h,s),w(h,h,i),o(this.look,h[0],h[1],h[2]);let a=g();y(a,0,1,0,0),w(a,a,i),o(this.up,a[0],a[1],a[2]),l(this.right,this.look,this.up),u(this.look,this.look),u(this.up,this.up),u(this.right,this.right),n(this.ref,this.eye,this.look)}updateAttributes(t,e){if(t.up&&(this.phi-=.1*e),t.down&&(this.phi+=.1*e),t.left&&(this.theta+=.1*e,console.log(this.theta)),t.right&&(this.theta-=.1*e,console.log(this.theta)),t.w){let t=r();a(t,this.look,e),n(this.eye,this.eye,t),n(this.ref,this.eye,this.look)}if(t.d){let t=r();a(t,this.right,e),h(this.eye,this.eye,t),n(this.ref,this.eye,this.look)}if(t.s){let t=r();a(t,this.look,e),h(this.eye,this.eye,t),n(this.ref,this.eye,this.look)}if(t.a){let t=r();a(t,this.right,e),n(this.eye,this.eye,t),n(this.ref,this.eye,this.look)}if(t.e){let t=r();o(t,0,e,0),n(this.eye,this.eye,t),n(this.ref,this.eye,this.look)}if(t.q){let t=r();a(t,this.up,e),h(this.eye,this.eye,t),n(this.ref,this.eye,this.look)}this.calculateRotation(),B.innerText="EYE : "+String(this.eye[0])+", "+String(this.eye[1])+", "+String(this.eye[2]),U.innerText="REF : "+String(this.ref[0])+", "+String(this.ref[1])+", "+String(this.ref[2]),S.innerText="LOOK : "+String(this.look[0])+", "+String(this.look[1])+", "+String(this.look[2]),E.innerText="UP : "+String(this.up[0])+", "+String(this.up[1])+", "+String(this.up[2]),C.innerText="RIGHT : "+String(this.right[0])+", "+String(this.right[1])+", "+String(this.right[2])}project(){var t=c();return function(t,e,i,r,s){var o,n=1/Math.tan(e/2);t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r)}(t,this.fovy,this.aspect[0]/this.aspect[1],this.nearClip,this.farClip),t}view(){var t=c();return function(t,i,r,s){var o,n,h,a,u,l,c,f,p,d,v=i[0],m=i[1],g=i[2],y=s[0],w=s[1],x=s[2],b=r[0],A=r[1],T=r[2];Math.abs(v-b)<e&&Math.abs(m-A)<e&&Math.abs(g-T)<e?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(c=v-b,f=m-A,p=g-T,o=w*(p*=d=1/Math.hypot(c,f,p))-x*(f*=d),n=x*(c*=d)-y*p,h=y*f-w*c,(d=Math.hypot(o,n,h))?(o*=d=1/d,n*=d,h*=d):(o=0,n=0,h=0),a=f*h-p*n,u=p*o-c*h,l=c*n-f*o,(d=Math.hypot(a,u,l))?(a*=d=1/d,u*=d,l*=d):(a=0,u=0,l=0),t[0]=o,t[1]=a,t[2]=c,t[3]=0,t[4]=n,t[5]=u,t[6]=f,t[7]=0,t[8]=h,t[9]=l,t[10]=p,t[11]=0,t[12]=-(o*v+n*m+h*g),t[13]=-(a*v+u*m+l*g),t[14]=-(c*v+f*m+p*g),t[15]=1)}(t,this.eye,this.ref,this.up),t}model(t){var e=c();return f(e,e,t,[0,0,1]),e}}class b{constructor(t,e){this.pos=r(),this.col=r(),this.pos=t,this.col=e}}let A={up:!1,down:!1,left:!1,right:!1,w:!1,a:!1,s:!1,d:!1,q:!1,e:!1};var T=function(t,e,i,r){return new(i||(i=Promise))((function(s,o){function n(t){try{a(r.next(t))}catch(t){o(t)}}function h(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,h)}a((r=r.apply(t,e||[])).next())}))};const k=document.getElementById("gfx-main"),P=new class{constructor(t){this.size=new Array(2),this.time=0,this.timeStep=.01,this.samples=4,this.frame=()=>{this.camera.updateAttributes(A,.1),this.mesh.rotateMesh(),this.render(),requestAnimationFrame(this.frame),this.time+=this.timeStep},this.canvas=t,this.size[0]=t.clientWidth,this.size[1]=t.clientHeight,this.camera=new x(Math.PI/4,t.width,t.height,.1,50,[0,0,-5],[0,0,0],[0,1,0]),this.light=new b([1,2,0],[1,1,1])}initialize(){return T(this,void 0,void 0,(function*(){yield this.setupDevice(),this.createAssets(),yield this.mesh.createTexture(this.device,"https://imgs.smoothradio.com/images/191589?width=1200&crop=1_1&signature=KHg-WnaLlH9KsZwE-qYgxTkaSpU="),yield this.makePipeline(),requestAnimationFrame(this.frame)}))}waitForTexture(){void 0!==this.mesh.texture?this.mesh.texture?console.log("Texture Loaded"):console.log("Texture Not Loaded"):setTimeout(this.waitForTexture,250)}setupDevice(){return T(this,void 0,void 0,(function*(){if(yield this.secureAdapter(),!this.adapter)return!1;for(;!this.device;)if(yield this.secureAdapter(),!this.adapter)return!1;this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}secureAdapter(){var t;return T(this,void 0,void 0,(function*(){if(!this.adapter&&(this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),!this.adapter))return null;this.device=yield this.adapter.requestDevice(),this.device.lost.then((t=>{console.error("Device was lost.",t),this.setupDevice()}))}))}makePipeline(){return T(this,void 0,void 0,(function*(){this.vertBuffer=this.device.createBuffer({size:256,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.fragBuffer=this.device.createBuffer({size:32,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const t=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),e=this.device.createSampler({magFilter:"linear",minFilter:"linear"});console.log("TEXTURE NEEDED"),yield this.waitForTexture(),this.bindGroup=this.device.createBindGroup({layout:t,entries:[{binding:0,resource:{buffer:this.vertBuffer,size:256,offset:0}},{binding:1,resource:{buffer:this.fragBuffer,size:32,offset:0}},{binding:2,resource:e},{binding:3,resource:this.mesh.texture.texture.createView()}]});const i=this.device.createPipelineLayout({bindGroupLayouts:[t]});this.pipeline=this.device.createRenderPipeline({layout:i,vertex:{module:this.device.createShaderModule({code:"struct TransformData {\r\n    model: mat4x4<f32>,\r\n    view: mat4x4<f32>,\r\n    projection: mat4x4<f32>,\r\n    normal: mat4x4<f32>\r\n};\r\n\r\n@binding(0) @group(0) var<uniform> transform: TransformData;\r\n\r\nstruct Fragment {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Normal : vec4<f32>,\r\n    @location(1) UV: vec2<f32>,\r\n    @location(2) NormalizedPos : vec4<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(@location(0) pos: vec3<f32>, @location(1) nor: vec3<f32>, @location(2) uv: vec2<f32>) -> Fragment {\r\n    var output : Fragment;\r\n    output.Position = transform.projection * transform.view * transform.model * vec4<f32>(pos, 1.0);\r\n    output.Normal = transform.normal * vec4<f32>(nor, 0.0);\r\n    output.UV = uv;\r\n    output.NormalizedPos = 0.5 * (vec4(pos, 0.0) + vec4(1.0, 1.0, 1.0, 1.0));\r\n    return output;\r\n}"}),entryPoint:"vs_main",buffers:[this.mesh.bufferLayout]},fragment:{module:this.device.createShaderModule({code:"struct Uniforms {\r\n            lightPos : vec4<f32>, \r\n            eyePos : vec4<f32>,\r\n        };\r\n\r\n@group(0) @binding(1) var<uniform> uniforms: Uniforms;\r\n@group(0) @binding(2) var textureSampler: sampler;\r\n@group(0) @binding(3) var texture: texture_2d<f32>;\r\n\r\n@fragment\r\nfn fs_main(\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Normal: vec4<f32>,\r\n    @location(1) UV: vec2<f32>,\r\n    @location(2) NormalizedPos : vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n    var textureColor : vec4<f32> = textureSample(texture, textureSampler, UV);\r\n    var lambert : f32 = max(dot(Normal.xyz, normalize(uniforms.eyePos.xyz - Position.xyz)), 0.0);\r\n    var ambient : f32 = 0.25; \r\n\r\n    var toonDim : f32 = 6.0;\r\n    var finalcolor : vec3<f32> = textureColor.xyz * (lambert + ambient);\r\n    finalcolor *= toonDim;\r\n    finalcolor = vec3<f32> (floor(finalcolor.x)/toonDim, floor(finalcolor.y)/toonDim, floor(finalcolor.z)/toonDim);\r\n\r\n    return vec4<f32>(finalcolor, 1.0);\r\n}"}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},multisample:{count:this.samples}}),this.depthTexture=this.device.createTexture({size:this.size,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:this.samples}),this.colorTexture=this.device.createTexture({size:this.size,sampleCount:this.samples,format:this.format,usage:GPUTextureUsage.RENDER_ATTACHMENT})}))}createAssets(){this.mesh=new v(this.device)}render(){var t,e,i,r,s,o,n,h,a,u,l,f,p,d,v,m,g,y,w,x,b,A,T,k,P,B,U,S,E,C,F,M=this.mesh.getModelMatrix(),D=c();t=D,i=(e=M)[0],r=e[1],s=e[2],o=e[3],n=e[4],h=e[5],a=e[6],u=e[7],l=e[8],f=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],(F=(w=i*h-r*n)*(C=p*(y=e[15])-d*g)-(x=i*a-s*n)*(E=f*y-d*m)+(b=i*u-o*n)*(S=f*g-p*m)+(A=r*a-s*h)*(U=l*y-d*v)-(T=r*u-o*h)*(B=l*g-p*v)+(k=s*u-o*a)*(P=l*m-f*v))&&(F=1/F,t[0]=(h*C-a*E+u*S)*F,t[1]=(s*E-r*C-o*S)*F,t[2]=(m*k-g*T+y*A)*F,t[3]=(p*T-f*k-d*A)*F,t[4]=(a*U-n*C-u*B)*F,t[5]=(i*C-s*U+o*B)*F,t[6]=(g*b-v*k-y*x)*F,t[7]=(l*k-p*b+d*x)*F,t[8]=(n*E-h*U+u*P)*F,t[9]=(r*U-i*E-o*P)*F,t[10]=(v*T-m*b+y*w)*F,t[11]=(f*b-l*T-d*w)*F,t[12]=(h*B-n*S-a*P)*F,t[13]=(i*S-r*B+s*P)*F,t[14]=(m*x-v*A-g*w)*F,t[15]=(l*A-f*x+p*w)*F),function(t,e){if(t===e){var i=e[1],r=e[2],s=e[3],o=e[6],n=e[7],h=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=s,t[13]=n,t[14]=h}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(D,D),this.device.queue.writeBuffer(this.vertBuffer,0,M),this.device.queue.writeBuffer(this.vertBuffer,64,this.camera.view()),this.device.queue.writeBuffer(this.vertBuffer,128,this.camera.project()),this.device.queue.writeBuffer(this.vertBuffer,192,D);let R=new Float32Array(4);R[0]=this.light.pos[0],R[1]=this.light.pos[1],R[2]=this.light.pos[2],R[3]=1;let G=new Float32Array(4);G[0]=this.camera.eye[0],G[1]=this.camera.eye[1],G[2]=this.camera.eye[2],G[3]=1,this.device.queue.writeBuffer(this.fragBuffer,0,R),this.device.queue.writeBuffer(this.fragBuffer,16,G);const z=this.device.createCommandEncoder(),q=this.context.getCurrentTexture().createView(),N=this.colorTexture.createView(),V=z.beginRenderPass({colorAttachments:[{view:4==this.samples?N:q,resolveTarget:4==this.samples?q:void 0,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTexture.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});V.setPipeline(this.pipeline),V.setBindGroup(0,this.bindGroup),V.setVertexBuffer(0,this.mesh.buffer),V.draw(this.mesh.idxCount,1,0,0),V.end(),this.device.queue.submit([z.finish()])}}(k);document.addEventListener("keydown",(function(t){"ArrowUp"==t.key?A.up=!0:"ArrowDown"==t.key?A.down=!0:"ArrowLeft"==t.key?A.left=!0:"ArrowRight"==t.key?A.right=!0:"w"==t.key?A.w=!0:"a"==t.key?A.a=!0:"s"==t.key?A.s=!0:"d"==t.key?A.d=!0:"q"==t.key?A.q=!0:"e"==t.key&&(A.e=!0),console.log(A)}),!1),document.addEventListener("keyup",(function(t){"ArrowUp"==t.key?A.up=!1:"ArrowDown"==t.key?A.down=!1:"ArrowLeft"==t.key?A.left=!1:"ArrowRight"==t.key?A.right=!1:"w"==t.key?A.w=!1:"a"==t.key?A.a=!1:"s"==t.key?A.s=!1:"d"==t.key?A.d=!1:"q"==t.key?A.q=!1:"e"==t.key&&(A.e=!1),console.log(A)}),!1),P.initialize();const B=document.getElementById("eye"),U=document.getElementById("ref"),S=document.getElementById("look"),E=document.getElementById("up"),C=document.getElementById("right")})();