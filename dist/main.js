(()=>{"use strict";const t="struct TransformData {\r\n    model: mat4x4<f32>,\r\n    view: mat4x4<f32>,\r\n    projection: mat4x4<f32>\r\n};\r\n\r\n@binding(0) @group(0) var<uniform> transform: TransformData;\r\n\r\nstruct Fragment {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Color : vec4<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(@location(0) pos: vec3<f32>, @location(1) col: vec3<f32>) -> Fragment {\r\n    var output : Fragment;\r\n    output.Position = transform.projection * transform.view * transform.model * vec4<f32>(pos, 1.0);\r\n    output.Color = vec4<f32>(col, 1.0);\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fs_main(@location(0) Color: vec4<f32>) -> @location(0) vec4<f32> {\r\n    return Color;\r\n}";class e{constructor(t){this.vertCount=0,this.idxCount=0,this.positions=new Array,this.colors=new Array,this.faces=new Array,this.createCube(),this.populateVBO();const e=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,s={size:this.vertDataVBO.byteLength,usage:e,mappedAtCreation:!0};this.buffer=t.createBuffer(s),new Float32Array(this.buffer.getMappedRange()).set(this.vertDataVBO),this.buffer.unmap(),this.bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]}}addVertex(t){console.log("adding vertex"),console.log(t.pos),console.log(t.col),this.positions.push(t.pos),this.colors.push(t.col),this.vertCount++}addFace(t,e){let i=new Array;for(let e=0;e<t.length;e++)i.push(this.vertCount),this.addVertex(t[e]);e?this.faces.push(new s(i,e)):this.faces.push(new s(i))}addFaceIndices(t,e){e?this.faces.push(new s(t,e)):this.faces.push(new s(t))}populateVBO(){var t=new Array;for(let e=0;e<this.faces.length;e++){const s=this.faces[e];for(let e=0;e<s.vertCount-2;e++){const i=null!=s.color?s.color:this.colors[s.verts[0]],o=null!=s.color?s.color:this.colors[s.verts[e+1]],r=null!=s.color?s.color:this.colors[s.verts[e+2]];t.push(this.positions[s.verts[0]][0]),t.push(this.positions[s.verts[0]][1]),t.push(this.positions[s.verts[0]][2]),t.push(i[0]),t.push(i[1]),t.push(i[2]),t.push(this.positions[s.verts[e+1]][0]),t.push(this.positions[s.verts[e+1]][1]),t.push(this.positions[s.verts[e+1]][2]),t.push(o[0]),t.push(o[1]),t.push(o[2]),t.push(this.positions[s.verts[e+2]][0]),t.push(this.positions[s.verts[e+2]][1]),t.push(this.positions[s.verts[e+2]][2]),t.push(r[0]),t.push(r[1]),t.push(r[2]),this.idxCount+=3,console.log("Adding Triangle"),console.log([0,e+1,e+2]),console.log([s.verts[0],s.verts[e+1],s.verts[e+2]])}}this.vertDataVBO=new Float32Array(t),console.log(this.vertCount),console.log(this.idxCount)}createCube(){let t=new Array;t.push({pos:[-1,-1,-1],col:[0,1,0],uv:void 0}),t.push({pos:[1,-1,-1],col:[1,0,0],uv:void 0}),t.push({pos:[1,1,-1],col:[0,0,1],uv:void 0}),t.push({pos:[-1,1,-1],col:[0,1,1],uv:void 0});let e=new Array;e.push({pos:[-1,-1,1],col:[0,1,0],uv:void 0}),e.push({pos:[1,-1,1],col:[1,0,0],uv:void 0}),e.push({pos:[1,1,1],col:[0,0,1],uv:void 0}),e.push({pos:[-1,1,1],col:[0,1,1],uv:void 0});let s=new Array;s.push({pos:[-1,-1,-1],col:[0,1,0],uv:void 0}),s.push({pos:[1,-1,-1],col:[1,0,0],uv:void 0}),s.push({pos:[1,-1,1],col:[0,0,1],uv:void 0}),s.push({pos:[-1,-1,1],col:[0,1,1],uv:void 0});let i=new Array;i.push({pos:[-1,1,-1],col:[0,1,0],uv:void 0}),i.push({pos:[1,1,-1],col:[1,0,0],uv:void 0}),i.push({pos:[1,1,1],col:[0,0,1],uv:void 0}),i.push({pos:[-1,1,1],col:[0,1,1],uv:void 0});let o=new Array;o.push({pos:[-1,-1,-1],col:[0,1,0],uv:void 0}),o.push({pos:[-1,1,-1],col:[1,0,0],uv:void 0}),o.push({pos:[-1,1,1],col:[0,0,1],uv:void 0}),o.push({pos:[-1,-1,1],col:[0,1,1],uv:void 0});let r=new Array;r.push({pos:[1,-1,-1],col:[0,1,0],uv:void 0}),r.push({pos:[1,1,-1],col:[1,0,0],uv:void 0}),r.push({pos:[1,1,1],col:[0,0,1],uv:void 0}),r.push({pos:[1,-1,1],col:[0,1,1],uv:void 0}),this.addFace(t,[1,0,0]),this.addFace(e,[0,1,0]),this.addFace(s,[0,0,1]),this.addFace(i,[1,0,1]),this.addFace(o,[1,1,0]),this.addFace(r,[0,1,1])}}class s{constructor(t,e){this.vertCount=0,this.verts=new Array;for(let e=0;e<t.length;e++)this.verts.push(t[e]);e&&(this.color=e),this.vertCount=t.length}addVertex(t){this.verts.push(t),this.vertCount++}}var i,o=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function h(t,e){var s=e[0],i=e[1],o=e[2],r=s*s+i*i+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function u(){var t=new r(16);return r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),n(),i=new r(2),r!=Float32Array&&(i[0]=0,i[1]=0);class c{constructor(t,e,s,i,o,u,c,p){var l,v,d;this.eye=n(),this.ref=n(),this.up=n(),this.right=n(),this.look=n(),this.fovy=t,this.aspect=(l=e,v=s,(d=new r(2))[0]=l,d[1]=v,d),this.nearClip=i,this.farClip=o,a(this.eye,u),a(this.ref,c),a(this.up,p),h(this.up,this.up),function(t,e,s){t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2]}(this.look,c,u),h(this.look,this.look),function(t,e,s){var i=e[0],o=e[1],r=e[2],n=s[0],a=s[1],h=s[2];t[0]=o*h-r*a,t[1]=r*n-i*h,t[2]=i*a-o*n}(this.right,this.look,p),h(this.right,this.right)}project(){var t=u();return function(t,e,s,i,o){var r,n=1/Math.tan(e/2);t[0]=n/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(r=1/(i-o),t[10]=(o+i)*r,t[14]=2*o*i*r):(t[10]=-1,t[14]=-2*i)}(t,this.fovy,this.aspect[0]/this.aspect[1],this.nearClip,this.farClip),t}view(){var t=u();return function(t,e,s,i){var r,n,a,h,u,c,p,l,v,d,f=e[0],m=e[1],g=e[2],y=i[0],w=i[1],A=i[2],C=s[0],b=s[1],x=s[2];Math.abs(f-C)<o&&Math.abs(m-b)<o&&Math.abs(g-x)<o?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(p=f-C,l=m-b,v=g-x,r=w*(v*=d=1/Math.hypot(p,l,v))-A*(l*=d),n=A*(p*=d)-y*v,a=y*l-w*p,(d=Math.hypot(r,n,a))?(r*=d=1/d,n*=d,a*=d):(r=0,n=0,a=0),h=l*a-v*n,u=v*r-p*a,c=p*n-l*r,(d=Math.hypot(h,u,c))?(h*=d=1/d,u*=d,c*=d):(h=0,u=0,c=0),t[0]=r,t[1]=h,t[2]=p,t[3]=0,t[4]=n,t[5]=u,t[6]=l,t[7]=0,t[8]=a,t[9]=c,t[10]=v,t[11]=0,t[12]=-(r*f+n*m+a*g),t[13]=-(h*f+u*m+c*g),t[14]=-(p*f+l*m+v*g),t[15]=1)}(t,this.eye,this.ref,this.up),t}model(t){var e=u();return function(t,e,s,i){var r,n,a,h,u,c,p,l,v,d,f,m,g,y,w,A,C,b,x,B,M,P,F,T,V=i[0],U=i[1],E=i[2],G=Math.hypot(V,U,E);G<o||(V*=G=1/G,U*=G,E*=G,r=Math.sin(s),a=1-(n=Math.cos(s)),h=e[0],u=e[1],c=e[2],p=e[3],l=e[4],v=e[5],d=e[6],f=e[7],m=e[8],g=e[9],y=e[10],w=e[11],A=V*V*a+n,C=U*V*a+E*r,b=E*V*a-U*r,x=V*U*a-E*r,B=U*U*a+n,M=E*U*a+V*r,P=V*E*a+U*r,F=U*E*a-V*r,T=E*E*a+n,t[0]=h*A+l*C+m*b,t[1]=u*A+v*C+g*b,t[2]=c*A+d*C+y*b,t[3]=p*A+f*C+w*b,t[4]=h*x+l*B+m*M,t[5]=u*x+v*B+g*M,t[6]=c*x+d*B+y*M,t[7]=p*x+f*B+w*M,t[8]=h*P+l*F+m*T,t[9]=u*P+v*F+g*T,t[10]=c*P+d*F+y*T,t[11]=p*P+f*F+w*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(e,e,t,[0,0,1]),e}}var p=function(t,e,s,i){return new(s||(s=Promise))((function(o,r){function n(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(n,a)}h((i=i.apply(t,e||[])).next())}))};const l=document.getElementById("gfx-main"),v=new class{constructor(t){this.size=new Array(2),this.time=0,this.timeStep=.01,this.samples=1,this.render=()=>{this.device.queue.writeBuffer(this.uniformBuffer,0,this.camera.model(this.time)),this.device.queue.writeBuffer(this.uniformBuffer,64,this.camera.view()),this.device.queue.writeBuffer(this.uniformBuffer,128,this.camera.project());const t=this.device.createTexture({size:this.size,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:this.samples}),e=this.device.createCommandEncoder(),s=this.context.getCurrentTexture().createView(),i=this.device.createTexture({size:this.size,sampleCount:this.samples,format:this.format,usage:GPUTextureUsage.RENDER_ATTACHMENT}).createView(),o=e.beginRenderPass({colorAttachments:[{view:4==this.samples?i:s,resolveTarget:4==this.samples?s:void 0,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:t.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});o.setPipeline(this.pipeline),o.setBindGroup(0,this.bindGroup),o.setVertexBuffer(0,this.mesh.buffer),o.draw(this.mesh.idxCount,1,0,0),o.end(),this.device.queue.submit([e.finish()]),requestAnimationFrame(this.render),this.time+=this.timeStep},this.canvas=t,this.size[0]=t.clientWidth,this.size[1]=t.clientHeight,this.camera=new c(Math.PI/4,t.width,t.height,.1,10,[-5,0,2],[0,0,0],[0,0,1])}initialize(){return p(this,void 0,void 0,(function*(){yield this.setupDevice(),this.createAssets(),yield this.makePipeline(),requestAnimationFrame(this.render)}))}setupDevice(){var t,e;return p(this,void 0,void 0,(function*(){this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),this.device=yield null===(e=this.adapter)||void 0===e?void 0:e.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}makePipeline(){return p(this,void 0,void 0,(function*(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const e=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.device.createBindGroup({layout:e,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const s=this.device.createPipelineLayout({bindGroupLayouts:[e]});this.pipeline=this.device.createRenderPipeline({layout:s,vertex:{module:this.device.createShaderModule({code:t}),entryPoint:"vs_main",buffers:[this.mesh.bufferLayout]},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},multisample:{count:this.samples}})}))}createAssets(){this.mesh=new e(this.device)}}(l);v.initialize()})();