(()=>{"use strict";const t="struct TransformData {\r\n    model: mat4x4<f32>,\r\n    view: mat4x4<f32>,\r\n    projection: mat4x4<f32>\r\n};\r\n\r\n@binding(0) @group(0) var<uniform> transform: TransformData;\r\n\r\nstruct Fragment {\r\n    @builtin(position) Position : vec4<f32>,\r\n    @location(0) Color : vec4<f32>\r\n};\r\n\r\n@vertex\r\nfn vs_main(@location(0) pos: vec3<f32>, @location(1) col: vec3<f32>) -> Fragment {\r\n    var output : Fragment;\r\n    output.Position = transform.projection * transform.view * transform.model * vec4<f32>(pos, 1.0);\r\n    output.Color = vec4<f32>(col, 1.0);\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fs_main(@location(0) Color: vec4<f32>) -> @location(0) vec4<f32> {\r\n    return Color;\r\n}";class e{constructor(t){const e=new Float32Array([0,0,.5,1,0,0,0,-.5,-.5,0,1,0,0,.5,-.5,0,0,1]),r=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,i={size:e.byteLength,usage:r,mappedAtCreation:!0};this.buffer=t.createBuffer(i),new Float32Array(this.buffer.getMappedRange()).set(e),this.buffer.unmap(),this.bufferLayout={arrayStride:24,attributes:[{shaderLocation:0,format:"float32x3",offset:0},{shaderLocation:1,format:"float32x3",offset:12}]}}}var r,i=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;function a(){var t=new n(3);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(t,e){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function u(){var t=new n(16);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),a(),r=new n(2),n!=Float32Array&&(r[0]=0,r[1]=0);class h{constructor(t,e,r,i,u,h,f,c){var l,d,v;this.eye=a(),this.ref=a(),this.up=a(),this.right=a(),this.look=a(),this.fovy=t,this.aspect=(l=e,d=r,(v=new n(2))[0]=l,v[1]=d,v),this.nearClip=i,this.farClip=u,o(this.eye,h),o(this.ref,f),o(this.up,c),function(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}(this.look,f,h),s(this.look,this.look),function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[0],s=r[1],u=r[2];t[0]=n*u-a*s,t[1]=a*o-i*u,t[2]=i*s-n*o}(this.right,this.look,c),s(this.right,this.right)}project(){var t=u();return function(t,e,r,i,n){var a,o=1/Math.tan(e/2);t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(a=1/(i-n),t[10]=(n+i)*a,t[14]=2*n*i*a):(t[10]=-1,t[14]=-2*i)}(t,this.fovy,this.aspect[0]/this.aspect[1],this.nearClip,this.farClip),t}view(){var t=u();return function(t,e,r,n){var a,o,s,u,h,f,c,l,d,v,p=e[0],m=e[1],g=e[2],y=n[0],b=n[1],M=n[2],w=r[0],P=r[1],B=r[2];Math.abs(p-w)<i&&Math.abs(m-P)<i&&Math.abs(g-B)<i?function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(t):(c=p-w,l=m-P,d=g-B,a=b*(d*=v=1/Math.hypot(c,l,d))-M*(l*=v),o=M*(c*=v)-y*d,s=y*l-b*c,(v=Math.hypot(a,o,s))?(a*=v=1/v,o*=v,s*=v):(a=0,o=0,s=0),u=l*s-d*o,h=d*a-c*s,f=c*o-l*a,(v=Math.hypot(u,h,f))?(u*=v=1/v,h*=v,f*=v):(u=0,h=0,f=0),t[0]=a,t[1]=u,t[2]=c,t[3]=0,t[4]=o,t[5]=h,t[6]=l,t[7]=0,t[8]=s,t[9]=f,t[10]=d,t[11]=0,t[12]=-(a*p+o*m+s*g),t[13]=-(u*p+h*m+f*g),t[14]=-(c*p+l*m+d*g),t[15]=1)}(t,this.eye,this.ref,this.up),t}model(){var t=u();return function(t,e,r,n){var a,o,s,u,h,f,c,l,d,v,p,m,g,y,b,M,w,P,B,x,A,C,F,G,q=n[0],U=n[1],L=n[2],k=Math.hypot(q,U,L);k<i||(q*=k=1/k,U*=k,L*=k,a=Math.sin(0),s=1-(o=Math.cos(0)),u=e[0],h=e[1],f=e[2],c=e[3],l=e[4],d=e[5],v=e[6],p=e[7],m=e[8],g=e[9],y=e[10],b=e[11],M=q*q*s+o,w=U*q*s+L*a,P=L*q*s-U*a,B=q*U*s-L*a,x=U*U*s+o,A=L*U*s+q*a,C=q*L*s+U*a,F=U*L*s-q*a,G=L*L*s+o,t[0]=u*M+l*w+m*P,t[1]=h*M+d*w+g*P,t[2]=f*M+v*w+y*P,t[3]=c*M+p*w+b*P,t[4]=u*B+l*x+m*A,t[5]=h*B+d*x+g*A,t[6]=f*B+v*x+y*A,t[7]=c*B+p*x+b*A,t[8]=u*C+l*F+m*G,t[9]=h*C+d*F+g*G,t[10]=f*C+v*F+y*G,t[11]=c*C+p*F+b*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(t,t,0,[0,0,1]),t}}var f=function(t,e,r,i){return new(r||(r=Promise))((function(n,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))};const c=document.getElementById("gfx-main"),l=new class{constructor(t){this.render=()=>{this.device.queue.writeBuffer(this.uniformBuffer,0,this.camera.model()),this.device.queue.writeBuffer(this.uniformBuffer,64,this.camera.view()),this.device.queue.writeBuffer(this.uniformBuffer,128,this.camera.project());const t=this.device.createCommandEncoder(),e=this.context.getCurrentTexture().createView(),r=t.beginRenderPass({colorAttachments:[{view:e,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}]});r.setPipeline(this.pipeline),r.setBindGroup(0,this.bindGroup),r.setVertexBuffer(0,this.triangleMesh.buffer),r.draw(3,1,0,0),r.end(),this.device.queue.submit([t.finish()]),requestAnimationFrame(this.render)},this.canvas=t,this.camera=new h(Math.PI/4,t.width,t.height,.1,10,[-2,0,2],[0,0,0],[0,0,1])}initialize(){return f(this,void 0,void 0,(function*(){yield this.setupDevice(),this.createAssets(),yield this.makePipeline(),this.render()}))}setupDevice(){var t,e;return f(this,void 0,void 0,(function*(){this.adapter=yield null===(t=navigator.gpu)||void 0===t?void 0:t.requestAdapter(),this.device=yield null===(e=this.adapter)||void 0===e?void 0:e.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",this.context.configure({device:this.device,format:this.format,alphaMode:"opaque"})}))}makePipeline(){return f(this,void 0,void 0,(function*(){this.uniformBuffer=this.device.createBuffer({size:192,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const e=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{}}]});this.bindGroup=this.device.createBindGroup({layout:e,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const r=this.device.createPipelineLayout({bindGroupLayouts:[e]});this.pipeline=this.device.createRenderPipeline({layout:r,vertex:{module:this.device.createShaderModule({code:t}),entryPoint:"vs_main",buffers:[this.triangleMesh.bufferLayout]},fragment:{module:this.device.createShaderModule({code:t}),entryPoint:"fs_main",targets:[{format:this.format}]},primitive:{topology:"triangle-list"}})}))}createAssets(){this.triangleMesh=new e(this.device)}}(c);l.initialize()})();